(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{"./dist/esm/verdocs-sign.entry.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"verdocs_sign",(function(){return VerdocsSign}));__webpack_require__("./node_modules/core-js/modules/es.object.assign.js"),__webpack_require__("./node_modules/core-js/modules/es.promise.js"),__webpack_require__("./node_modules/core-js/modules/es.object.to-string.js"),__webpack_require__("./node_modules/core-js/modules/es.symbol.js"),__webpack_require__("./node_modules/core-js/modules/es.symbol.description.js"),__webpack_require__("./node_modules/core-js/modules/es.symbol.iterator.js"),__webpack_require__("./node_modules/core-js/modules/es.string.iterator.js"),__webpack_require__("./node_modules/core-js/modules/es.array.iterator.js"),__webpack_require__("./node_modules/core-js/modules/web.dom-collections.iterator.js"),__webpack_require__("./node_modules/core-js/modules/es.array.concat.js"),__webpack_require__("./node_modules/core-js/modules/es.regexp.to-string.js"),__webpack_require__("./node_modules/core-js/modules/es.date.to-string.js"),__webpack_require__("./node_modules/core-js/modules/es.regexp.constructor.js"),__webpack_require__("./node_modules/core-js/modules/es.regexp.exec.js"),__webpack_require__("./node_modules/core-js/modules/es.array.find-index.js"),__webpack_require__("./node_modules/core-js/modules/es.array.filter.js"),__webpack_require__("./node_modules/core-js/modules/es.function.name.js"),__webpack_require__("./node_modules/core-js/modules/es.string.split.js"),__webpack_require__("./node_modules/core-js/modules/web.url.js"),__webpack_require__("./node_modules/core-js/modules/es.array.map.js"),__webpack_require__("./node_modules/core-js/modules/es.array.find.js"),__webpack_require__("./node_modules/core-js/modules/es.object.define-property.js");var _index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("./dist/esm/index-ade0ef1e.js"),_Token_b82a8ea3_js__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__("./dist/esm/Token-b82a8ea3.js"),_buffer_es6_681a33da_js__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__("./dist/esm/buffer-es6-681a33da.js");__webpack_require__("./dist/esm/index-2b1938ea.js");function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function getRGBA(roleIndex){switch(roleIndex%10){case 0:return 0===roleIndex?"rgba(255, 193, 7, 0.4)":"rgba(134, 134, 134, 0.3)";case 1:return"rgba(156, 39, 176, .4)";case 2:return"rgba(33, 150, 243, .4)";case 3:return"rgba(220, 231, 117, 0.3)";case 4:return"rgba(121, 134, 203, 0.3)";case 5:return"rgba(77, 182, 172, 0.3)";case 6:return"rgba(255, 202, 165, 0.3)";case 7:return"rgba(2, 247, 190, 0.3)";case 8:return"rgba(255, 138, 101, 0.3)";case 9:return"rgba(82, 255, 79, 0.3)";default:return"rgba(229, 115, 155, 0.3)"}}function rescale(r,n){return r*n}var __assign=function(){return __assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t},__assign.apply(this,arguments)},__awaiter$1=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator$1=function(thisArg,body){var f,y,t,g,_={label:0,sent:function sent(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=_.trys,(t=t.length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function sent(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=_.trys,(t=t.length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},getSigningSession=function getSigningSession(params){return __awaiter(void 0,void 0,void 0,(function(){return __generator(this,(function(_a){return[2,Object(_Token_b82a8ea3_js__WEBPACK_IMPORTED_MODULE_23__.c)().api.get("/documents/".concat(params.documentId,"/recipients/").concat(encodeURIComponent(params.roleId),"/invitation/").concat(params.inviteCode)).then((function(r){var _a,_b,signerToken=(null===(_a=r.headers)||void 0===_a?void 0:_a.signer_token)||"",session=Object(_Token_b82a8ea3_js__WEBPACK_IMPORTED_MODULE_23__.b)(signerToken);return Object(_Token_b82a8ea3_js__WEBPACK_IMPORTED_MODULE_23__.c)().setAuthorization(null===(_b=r.headers)||void 0===_b?void 0:_b.signer_token),{recipient:r.data,session:session,signerToken:signerToken}}))]}))}))},getDocument=function getDocument(documentId){return __awaiter(void 0,void 0,void 0,(function(){return __generator(this,(function(_a){return[2,Object(_Token_b82a8ea3_js__WEBPACK_IMPORTED_MODULE_23__.c)().api.get("/documents/".concat(documentId)).then((function(r){return r.data}))]}))}))},getDocumentFile=function getDocumentFile(documentId,envelopeDocumentId){return __awaiter(void 0,void 0,void 0,(function(){return __generator(this,(function(_a){return[2,Object(_Token_b82a8ea3_js__WEBPACK_IMPORTED_MODULE_23__.c)().api.get("/documents/".concat(documentId,"/envelope_documents/").concat(envelopeDocumentId,"?file=true"),{responseType:"arraybuffer"}).then((function(r){return _buffer_es6_681a33da_js__WEBPACK_IMPORTED_MODULE_24__.a.from(r.data,"binary").toString("base64")}))]}))}))},updateDocumentField=function updateDocumentField(documentId,fieldName,value){return __awaiter(void 0,void 0,void 0,(function(){return __generator(this,(function(_a){return[2,Object(_Token_b82a8ea3_js__WEBPACK_IMPORTED_MODULE_23__.c)().api.put("/documents/".concat(documentId,"/fields/").concat(fieldName),value).then((function(r){return r.data}))]}))}))},e164Regex=new RegExp(/\+[1-9]\d{6,14}/g);var EmailRegEx=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,isValidPhone=function isValidPhone(value){return function simpleE164Validator(code){return null!==code&&code.length<16&&code.length>6&&e164Regex.test(code)||""===code||null===code}(value)},BASE_URL="https://stage-api.verdocs.com",VerdocsSign=function(){function VerdocsSign(hostRef){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,VerdocsSign),Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.g)(this,hostRef),this.documentid=null,this.roleid=null,this.invitecode=null,this.endpoint=null,this.recipient=null,this.signerToken=null,this.pdfUrl=null,this.recipientIndex=-1,this.document=null,this.fields=[],this.hasSignature=!1,this.nextButtonLabel="Start",this.focusedField=""}var _handleFieldChange,_handleOptionSelected,_savePDF,_componentDidLoad;return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(VerdocsSign,[{key:"componentWillLoad",value:function componentWillLoad(){var endpoint=(new _Token_b82a8ea3_js__WEBPACK_IMPORTED_MODULE_23__.a).setBaseURL(BASE_URL);Object(_Token_b82a8ea3_js__WEBPACK_IMPORTED_MODULE_23__.d)(endpoint)}},{key:"componentDidLoad",value:(_componentDidLoad=_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var _yield$getSigningSess,session,recipient,signerToken,_document,_this=this;return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.prev=0,console.log("[SIGN] Processing invite code",this.documentid,this.roleid,this.invitecode),_context.next=4,getSigningSession({documentId:this.documentid,roleId:this.roleid,inviteCode:this.invitecode});case 4:return _yield$getSigningSess=_context.sent,session=_yield$getSigningSess.session,recipient=_yield$getSigningSess.recipient,signerToken=_yield$getSigningSess.signerToken,console.log("[SIGN] Got signing session",session),console.log("[SIGN] Recipient",recipient),this.recipient=recipient,this.signerToken=signerToken,Object(_Token_b82a8ea3_js__WEBPACK_IMPORTED_MODULE_23__.c)().setSigningAuthorization(signerToken),this.recipient.agreed&&(this.nextButtonLabel="Next"),_context.next=16,getDocument(this.documentid);case 16:_document=_context.sent,this.document=_document,console.log("[SIGN] Document",_document),this.pdfUrl=BASE_URL+"/documents/"+this.documentid+"/envelope_documents/"+_document.envelope_document_id+"?file=true",this.recipientIndex=this.document.recipients.findIndex((function(recipient){return recipient.role_name==_this.roleid})),this.recipientIndex>-1&&console.log("Found recipient",this.document.recipients[this.recipientIndex]),this.fields=this.document.fields.filter((function(field){return field.recipient_role===_this.roleid})),console.log("Loaded fields",this.fields),_context.next=29;break;case 26:_context.prev=26,_context.t0=_context.catch(0),console.log("Error with signing session",_context.t0);case 29:case"end":return _context.stop()}}),_callee,this,[[0,26]])}))),function componentDidLoad(){return _componentDidLoad.apply(this,arguments)})},{key:"handleClickAgree",value:function handleClickAgree(){var _this2=this;console.log("agree clicked"),function updateRecipientStatus(documentId,roleName,action,params){return __awaiter$1(void 0,void 0,void 0,(function(){return __generator$1(this,(function(_a){return[2,Object(_Token_b82a8ea3_js__WEBPACK_IMPORTED_MODULE_23__.c)().api.put("/documents/".concat(documentId,"/recipients/").concat(roleName),__assign({role_name:roleName,action:action},params||{})).then((function(r){return r.data}))]}))}))}(this.documentid,this.roleid,"update",{agreed:!0}).then((function(r){console.log("update result",r),_this2.nextButtonLabel="Next",_this2.recipient=r})).catch((function(e){console.log("update failure",e)}))}},{key:"savePDF",value:(_savePDF=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(){var fileName,data,xhr,url;return regeneratorRuntime.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return fileName=this.document.name+" - "+this.document.updated_at.split("T")[0]+".pdf",_context2.next=3,getDocumentFile(this.documentid,this.document.envelope_document_id);case 3:data=_context2.sent,(xhr=new XMLHttpRequest).responseType="blob",xhr.onload=function(){var a=document.createElement("a");a.href=window.URL.createObjectURL(xhr.response),a.download=fileName,a.style.display="none",document.body.appendChild(a),a.click(),a.remove()},url="data:application/pdf;base64,"+data,console.log("url",url.length,url),xhr.open("GET","data:application/pdf;base64,"+data),xhr.send();case 11:case"end":return _context2.stop()}}),_callee2,this)}))),function savePDF(){return _savePDF.apply(this,arguments)})},{key:"handleOptionSelected",value:(_handleOptionSelected=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(e){return regeneratorRuntime.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:_context3.t0=e.detail.id,_context3.next="later"===_context3.t0?3:"claim"===_context3.t0?5:"decline"===_context3.t0?6:"print"===_context3.t0?7:"download"===_context3.t0?8:10;break;case 3:return(null===window||void 0===window?void 0:window.STORYBOOK_ENV)||window.alert("User intends to sign later."),_context3.abrupt("break",10);case 5:case 6:case 7:return _context3.abrupt("break",10);case 8:return this.savePDF().catch((function(){})),_context3.abrupt("break",10);case 10:case"end":return _context3.stop()}}),_callee3,this)}))),function handleOptionSelected(_x){return _handleOptionSelected.apply(this,arguments)})},{key:"handleFieldChange",value:(_handleFieldChange=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(field,e,optionId){var options;return regeneratorRuntime.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:console.log("fieldChange",field,e.detail),_context4.t0=field.type,_context4.next="textbox"===_context4.t0?4:"checkbox_group"===_context4.t0?6:"radio_button_group"===_context4.t0?8:"dropdown"===_context4.t0?11:"initial"===_context4.t0?13:"signature"===_context4.t0?15:17;break;case 4:case 11:return updateDocumentField(this.documentid,field.name,{prepared:!1,value:e.detail}).then((function(r){return console.log("Update result",r)})).catch((function(e){return console.log("Error updating",e)})),_context4.abrupt("break",17);case 6:return updateDocumentField(this.documentid,field.name,{prepared:!1,value:{options:[{id:optionId,checked:e.detail}]}}).then((function(r){return console.log("Update result",r)})).catch((function(e){return console.log("Error updating",e)})),_context4.abrupt("break",17);case 8:return options=field.settings.options.map((function(option){return{id:option.id,selected:optionId===option.id}})),updateDocumentField(this.documentid,field.name,{prepared:!1,value:{options:options}}).then((function(r){return console.log("Update result",r)})).catch((function(e){return console.log("Error updating",e)})),_context4.abrupt("break",17);case 13:return console.log("Got initial",e.detail),_context4.abrupt("break",17);case 15:return console.log("Got signature",e.detail),_context4.abrupt("break",17);case 17:case"end":return _context4.stop()}}),_callee4,this)}))),function handleFieldChange(_x2,_x3,_x4){return _handleFieldChange.apply(this,arguments)})},{key:"renderCheckboxGroupOption",value:function renderCheckboxGroupOption(page,field,option,index){var _this3=this,style={left:rescale(page.xRatio,option.x)+"px",bottom:rescale(page.yRatio,option.y)+"px",position:"absolute",transform:"scale("+page.xRatio+", "+page.yRatio+")",backgroundColor:getRGBA(this.recipientIndex)};return Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("verdocs-field-checkbox",{style:style,order:index,value:option.checked,onFieldChange:function onFieldChange(e){return _this3.handleFieldChange(field,e,option.id)}})}},{key:"renderRadioGroupOption",value:function renderRadioGroupOption(page,field,option,index){var _this4=this,style={left:rescale(page.xRatio,option.x)+"px",bottom:rescale(page.yRatio,option.y)+"px",position:"absolute",transform:"scale("+page.xRatio+", "+page.yRatio+")",backgroundColor:getRGBA(this.recipientIndex)};return Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("verdocs-field-radio-button",{style:style,order:index,value:option.id,name:field.name,checked:option.selected,onFieldChange:function onFieldChange(e){return _this4.handleFieldChange(field,e,option.id)}})}},{key:"renderField",value:function renderField(field,index){var _this5=this,_field$required=field.required,required=void 0!==_field$required&&_field$required,_field$settings=field.settings,settings=void 0===_field$settings?{}:_field$settings,_settings$x=settings.x,x=void 0===_settings$x?0:_settings$x,_settings$y=settings.y,y=void 0===_settings$y?0:_settings$y,_settings$base=settings.base64,base64=void 0===_settings$base?"":_settings$base,_settings$placeholder=settings.placeholder,placeholder=void 0===_settings$placeholder?"":_settings$placeholder,_settings$options=settings.options,options=void 0===_settings$options?[]:_settings$options,_settings$value=settings.value,value=void 0===_settings$value?"":_settings$value,_settings$result=settings.result,result=void 0===_settings$result?"":_settings$result,renderOnPage=this.pdfPageInfo.pages.find((function(page){return page.pageNumber===field.page}));if(!renderOnPage)return console.log("Unable to render invalid field",field),Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("div",{class:"invalid-field"},"Invalid field.");var style={left:rescale(renderOnPage.xRatio,x)+"px",bottom:rescale(renderOnPage.yRatio,y)+"px",position:"absolute",transform:"scale("+renderOnPage.xRatio+", "+renderOnPage.yRatio+")",backgroundColor:field.settings.rgba||getRGBA(this.recipientIndex)};field.settings.height&&(style.height=field.settings.height+"px"),field.settings.width&&(style.width=field.settings.width+"px"),console.log("rendering field",field.type,field);var id="field-"+field.name;switch(field.type){case"signature":return Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("verdocs-field-signature",{style:style,value:base64,required:required,id:id});case"initial":return Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("verdocs-field-initial",{style:style,required:required,id:id});case"textbox":return Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("verdocs-field-textbox",{style:style,order:index,value:result||"",placeholder:placeholder,id:id,onFieldChange:function onFieldChange(e){return _this5.handleFieldChange(field,e)}});case"textarea":return Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("verdocs-field-textarea",{style:style,placeholder:placeholder||"",id:id});case"date":return Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("verdocs-field-date",{style:style,order:index,value:result||"",placeholder:placeholder,required:required,id:id});case"dropdown":return Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("verdocs-field-dropdown",{style:style,options:options,value:value,required:required,id:id,onFieldChange:function onFieldChange(e){return _this5.handleFieldChange(field,e)}});case"checkbox":return Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("verdocs-field-checkbox",{style:style,value:result||"",id:id});case"checkbox_group":return field.settings.options.map((function(option,index){return _this5.renderCheckboxGroupOption(renderOnPage,field,option,index)}));case"radio_button_group":return field.settings.options.map((function(option,index){return _this5.renderRadioGroupOption(renderOnPage,field,option,index)}));case"attachment":return Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("verdocs-field-attachment",{style:style,value:result||"",id:id});case"payment":return Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("verdocs-field-payment",{style:style,field:field,id:id});default:console.log("[SIGN] Skipping unsupported field type",field)}return Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("div",{style:{display:"none"}},'Unsupported field type "',field.type,'"')}},{key:"isFieldValid",value:function isFieldValid(field){var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m;switch(field.type){case"textbox":switch((null===(_a=field.settings)||void 0===_a?void 0:_a.validator)||""){case"email":return function isValidEmail(value){return EmailRegEx.test(value)}((null===(_b=field.settings)||void 0===_b?void 0:_b.result)||"");case"phone":return isValidPhone((null===(_c=field.settings)||void 0===_c?void 0:_c.result)||"");default:return!!(null===(_d=field.settings)||void 0===_d?void 0:_d.result)}case"signature":case"initial":case"textarea":case"date":case"attachment":return!!(null===(_e=field.settings)||void 0===_e?void 0:_e.result);case"dropdown":return!!(null===(_f=field.settings)||void 0===_f?void 0:_f.value);case"checkbox_group":var checked=((null===(_h=null===(_g=field.settings)||void 0===_g?void 0:_g.options)||void 0===_h?void 0:_h.filter((function(option){return option.checked})))||[]).length;return checked>=((null===(_j=field.settings)||void 0===_j?void 0:_j.minimum_checked)||0)&&checked<=((null===(_k=field.settings)||void 0===_k?void 0:_k.maximum_checked)||999);case"radio_button_group":return((null===(_m=null===(_l=field.settings)||void 0===_l?void 0:_l.options)||void 0===_m?void 0:_m.filter((function(option){return option.selected})))||[]).length>0;default:return!1}}},{key:"handleDocumentRendered",value:function handleDocumentRendered(e){console.log("[SIGN] Document rendered",e.detail),this.pdfPageInfo=e.detail}},{key:"handleNext",value:function handleNext(){var _this6=this,requiredFields=this.fields.filter((function(field){return field.required}));console.log("required Fields",requiredFields);var focusedIndex=requiredFields.findIndex((function(field){return field.name===_this6.focusedField}));console.log("focused Index",focusedIndex);var nextFocusedIndex=focusedIndex+1;nextFocusedIndex>=requiredFields.length&&(nextFocusedIndex=0);var nextRequiredField=requiredFields[nextFocusedIndex];if(console.log("next required fielod",nextRequiredField),nextRequiredField){var el=document.getElementById("field-"+nextRequiredField.name);null==el||el.focusField(),this.focusedField=nextRequiredField.name}}},{key:"render",value:function render(){var _a,_b,_c,_d,_e,_this7=this;return Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.a,{class:{storybook:!!(null===window||void 0===window?void 0:window.STORYBOOK_ENV),agreed:null===(_a=this.recipient)||void 0===_a?void 0:_a.agreed}},Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("div",{class:"header"},Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("div",{class:"intro"},"Please review and act on these documents."),Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("div",{class:"toolbar"},Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("div",{class:"tools"},Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("verdocs-dropdown",{options:[{id:"later",label:"Finish Later"},{id:"claim",label:"Claim the Document",disabled:!0},{id:"decline",label:"Decline to Sign"},{id:"print",label:"Print Without Signing"},{id:"download",label:"Download"}],onOptionSelected:function onOptionSelected(e){return _this7.handleOptionSelected(e)}}),(null===(_b=this.recipient)||void 0===_b?void 0:_b.agreed)?Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("div",{style:{flex:"1"}}):Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("div",{style:{flex:"1",flexDirection:"row",display:"flex",alignItems:"center"}},Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("div",{class:"agree-checkbox"},Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("input",{type:"checkbox",value:"None",id:"agree-checkbox-element",name:"agree",onChange:function onChange(){return _this7.handleClickAgree()}}),Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("label",{htmlFor:"agree-checkbox-element"})),"I agree to use electronic records and signatures."),Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("verdocs-button",{label:this.nextButtonLabel,disabled:!(null===(_c=this.recipient)||void 0===_c?void 0:_c.agreed),onClick:function onClick(){return _this7.handleNext()}})))),(null===(_d=this.recipient)||void 0===_d?void 0:_d.agreed)?Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("div",{style:{display:"none"}}):Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("div",{class:"cover"}),Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("div",{class:"document"},this.pdfUrl?Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("verdocs-view",{source:this.pdfUrl,token:this.signerToken,onDocumentRendered:function onDocumentRendered(e){return _this7.handleDocumentRendered(e)}}):Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("verdocs-loader",null),((null===(_e=this.pdfPageInfo)||void 0===_e?void 0:_e.pages)||[]).map((function(page){var _a;return Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("div",{class:"page-controls",style:{height:page.height+"px",width:page.width+"px",top:page.canvasTop+"px",margin:"0 auto"}},(null===(_a=_this7.pdfPageInfo)||void 0===_a?void 0:_a.numRendered)>0?_this7.fields.filter((function(field){return field.page===page.pageNumber})).map((function(field,index){return _this7.renderField(field,index)})):Object(_index_ade0ef1e_js__WEBPACK_IMPORTED_MODULE_22__.e)("div",{style:{display:"none"}},"Waiting for PDF to render..."))}))))}}]),VerdocsSign}();VerdocsSign.style='verdocs-sign{font-family:sans-serif;font-family:var(--verdocs-font);position:relative;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;min-height:600px;-webkit-box-sizing:border-box;box-sizing:border-box;overflow:hidden}verdocs-sign.storybook{max-height:600px}verdocs-sign div{-webkit-box-sizing:border-box;box-sizing:border-box}verdocs-sign .header{-ms-flex:0 0 115px;flex:0 0 115px;z-index:1000;background-color:#33354c;-webkit-box-shadow:0 4px 4px 0 rgba(0, 0, 0, 0.24), 0 0 4px 0 rgba(0, 0, 0, 0.12);box-shadow:0 4px 4px 0 rgba(0, 0, 0, 0.24), 0 0 4px 0 rgba(0, 0, 0, 0.12);-webkit-transition:all 0.25s;transition:all 0.25s}verdocs-sign .intro{background-color:#ffffff;width:100%;margin:0 auto;padding:20px;max-width:1028px;color:rgba(0, 0, 0, 0.87)}verdocs-sign .toolbar{width:100%;margin:0 auto;padding:0 20px;max-width:1028px;position:relative}verdocs-sign .tools{width:100%;color:#fff;height:56px;padding:4px;display:-ms-flexbox;display:flex;font-size:12px;-ms-flex-align:center;align-items:center;-ms-flex-direction:row;flex-direction:row;background-color:#33354c}verdocs-sign .cover{top:0;left:0;right:0;bottom:0;z-index:999;position:absolute;background:rgba(0, 0, 0, 0.5)}verdocs-sign .document{-ms-flex:1;flex:1;height:100%;position:relative;overflow-y:scroll}verdocs-sign .agree-checkbox{-ms-flex:0 0 20px;flex:0 0 20px;display:-ms-flexbox;display:flex;width:20px;height:20px;border-radius:3px;background:#ffffff;position:relative;margin:0 10px 0 30px}verdocs-sign .agree-checkbox label{left:2px;top:2px;width:16px;height:16px;cursor:pointer;position:absolute;background:#33354c;-webkit-box-shadow:inset 0 -1px 1px rgba(255, 255, 255, 0.8);box-shadow:inset 0 -1px 1px rgba(255, 255, 255, 0.8)}verdocs-sign .agree-checkbox label:after{top:2px;left:3px;width:8px;opacity:0;height:5px;content:"";position:absolute;background:transparent;filter:alpha(opacity=0);-webkit-transform:rotate(-45deg);transform:rotate(-45deg);border:2px solid #fcfff4;border-top:none;border-right:none}verdocs-sign .agree-checkbox label:hover::after{filter:alpha(opacity=30);opacity:0.3}verdocs-sign .agree-checkbox input[type=checkbox]:checked+label:after{filter:alpha(opacity=100);opacity:1}verdocs-sign.agreed .intro{display:none}verdocs-sign.agreed .header{-ms-flex:0 0 56px;flex:0 0 56px}verdocs-sign.agreed .agree-checkbox{background:#ccc}verdocs-sign.agreed .agree-checkbox label{cursor:default}verdocs-sign .page-controls{position:absolute;left:50%;-webkit-transform:translateX(-50%);transform:translateX(-50%);z-index:500}'}}]);