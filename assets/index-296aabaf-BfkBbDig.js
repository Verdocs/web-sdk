import{a,f as p}from"./preview-X13RbvS2.js";const M=(e,o,s)=>{const c=e.get(o);c?c.includes(s)||c.push(s):e.set(o,[s])},O=(e,o)=>{let s;return(...c)=>{s&&clearTimeout(s),s=setTimeout(()=>{s=0,e(...c)},o)}},_=e=>!("isConnected"in e)||e.isConnected,w=O(e=>{for(let o of e.keys())e.set(o,e.get(o).filter(_))},2e3),T=()=>{if(typeof a!="function")return{};const e=new Map;return{dispose:()=>e.clear(),get:o=>{const s=a();s&&M(e,o,s)},set:o=>{const s=e.get(o);s&&e.set(o,s.filter(p)),w(e)},reset:()=>{e.forEach(o=>o.forEach(p)),w(e)}}},d=e=>typeof e=="function"?e():e,U=(e,o=(s,c)=>s!==c)=>{const s=d(e);let c=new Map(Object.entries(s??{}));const i={dispose:[],get:[],set:[],reset:[]},g=()=>{var t;c=new Map(Object.entries((t=d(e))!==null&&t!==void 0?t:{})),i.reset.forEach(n=>n())},E=()=>{i.dispose.forEach(t=>t()),g()},h=t=>(i.get.forEach(n=>n(t)),c.get(t)),l=(t,n)=>{const r=c.get(t);o(n,r,t)&&(c.set(t,n),i.set.forEach(f=>f(t,n,r)))},y=typeof Proxy>"u"?{}:new Proxy(s,{get(t,n){return h(n)},ownKeys(t){return Array.from(c.keys())},getOwnPropertyDescriptor(){return{enumerable:!0,configurable:!0}},has(t,n){return c.has(n)},set(t,n,r){return l(n,r),!0}}),u=(t,n)=>(i[t].push(n),()=>{P(i[t],n)});return{state:y,get:h,set:l,on:u,onChange:(t,n)=>{const r=u("set",(x,C)=>{x===t&&n(C)}),f=u("reset",()=>n(d(e)[t]));return()=>{r(),f()}},use:(...t)=>{const n=t.reduce((r,f)=>(f.set&&r.push(u("set",f.set)),f.get&&r.push(u("get",f.get)),f.reset&&r.push(u("reset",f.reset)),f.dispose&&r.push(u("dispose",f.dispose)),r),[]);return()=>n.forEach(r=>r())},dispose:E,reset:g,forceUpdate:t=>{const n=c.get(t);i.set.forEach(r=>r(t,n,n))}}},P=(e,o)=>{const s=e.indexOf(o);s>=0&&(e[s]=e[e.length-1],e.length--)},S=(e,o)=>{const s=U(e,o);return s.use(T()),s};export{S as c};
